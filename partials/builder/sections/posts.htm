[collection posts]
handle = "Blog\Posts"

[global settings]
handle = "Content\Settings"
==
{% if settings.enable_blog == true %}

    {% set sort_order = section.reverse_order ? 'desc' : 'asc' %}

    {% if section.filter_by_category %}
        {% set posts = posts.whereRelation('categories', 'id', section.post_category_filter.id) %}
    {% endif %}

    {% if section.sort_by == 'title' %}
        {% set posts = posts.orderBy('title', sort_order) %}
    {% endif %}

    {% if section.sort_by == 'date' %}
        {% set posts = posts.orderBy('published_at_date', sort_order) %}
    {% endif %}

    {% if section.enable_pagination %}
        {% set posts = posts.paginateCustom(section.per_page, "posts") %}
    {% else %}
        {% set posts = posts.limit(section.limit).get() %}
    {% endif %}

    <section 
            {{ section.html_anchor|length ? 'id="' ~  section.html_anchor  ~ '"' }}
            class="{% if section.css_classes|length %}
                        {% for class in section.css_classes|split(',') %}
                            {{ class ~ ' ' }}
                        {% endfor %}
                   {% endif %}
                   {{ section.style == 'light' ? 'bg-light' }} 
                   {{ section.style == 'dark' ? 'bg-dark text-white' }} 
                   {{ section.disable_top_spacing == true ? 'pt-0' : "pt-4" }} 
                   {{ section.disable_bottom_spacing == true ? 'pb-0' : "pb-4" }}"
    >
        <div class="{{ section.container_style }}">
            <div class="row row-cols-lg-{{ section.enable_pagination ? section.per_page : section.limit }}">
                {% for post in posts %}
                    <div class="col{{ section.per_page > 4 ? "-12 col-lg-3" }}{{ section.limit > 4 ? "-12 col-lg-3" }} mb-4">
                        <div class="card h-100">
                            <a href="{{ 'post'|page({ fullslug: post.slug }) }}" class="card-img-top">
                                <img
                                        src="{{ post.image|media|resize(700, 400, {mode: 'crop'}) }}"
                                        alt="{{ post.title }}" class="card-img-top"
                                >
                            </a>
                            <div class="card-body d-flex flex-column h-100 align-items-start">
                                <h3 class="text-decoration-none text-dark fs-5">
                                    <a href="{{ 'post'|page({ fullslug: post.slug }) }}" class="text-decoration-none text-reset">{{ post.title }}</a>
                                </h3>
                                <p>{{ post.excerpt }}</p>
                                <a href="{{ 'post'|page({ fullslug: post.slug }) }}" class="btn btn-primary mt-auto">Read</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            {% if section.enable_pagination %}
                <div class="d-flex justify-content-center">
                    {{ posts.links|raw }}
                </div>
            {% endif %}
        </div>
    </section>
{% endif %}